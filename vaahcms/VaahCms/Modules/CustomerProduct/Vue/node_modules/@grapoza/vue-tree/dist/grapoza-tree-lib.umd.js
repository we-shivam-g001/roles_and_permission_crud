(function(q,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(q=typeof globalThis<"u"?globalThis:q||self,e(q.grapozaTreeLib={},q.Vue))})(this,function(q,e){"use strict";const E=Object.freeze({None:null,Single:"single",Multiple:"multiple",SelectionFollowsFocus:"selectionFollowsFocus"});function be(){function l(){const a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let r="grt-";do r+=a.charAt(Math.floor(Math.random()*a.length));while(r.length<8||document.getElementById(r));return r}function n(a,r){const b=a.treeNodeSpec.idProperty,s=a[b],h=a[a.treeNodeSpec.childrenProperty];if(document.getElementById(`${r}-${s}`)){let t=1;for(;document.getElementById(`${r}-${s}-${t}`);)t++;a[b]=`${s}-${t}`}h.forEach(t=>n(t,r))}return{generateUniqueId:l,resolveNodeIdConflicts:n}}function ae(){function l(n){var a;return e.unref(n)[(a=e.unref(n).treeNodeSpec.childrenProperty)!=null?a:"children"]}return{getChildren:l}}function W(){const{getChildren:l}=ae();function n(r){return a(l(r))}function a(r){return e.unref(r).filter(b=>{var s,h,t,o,m,C;return((t=(h=(s=b.treeNodeSpec)==null?void 0:s._)==null?void 0:h.state)==null?void 0:t.matchesFilter)||((C=(m=(o=b.treeNodeSpec)==null?void 0:o._)==null?void 0:m.state)==null?void 0:C.subnodeMatchesFilter)})}return{getFilteredChildren:n,getFilteredNodes:a}}function ie(l){const{getFilteredChildren:n,getFilteredNodes:a}=W();function r(h){s(h,!1)}function b(h){s(h,!0)}function s(h,t){const o=a(l);if(o.length===0)return;let m=o.slice(),C=!0;for(;m.length>0&&C!==!1;){const p=m.shift(),c=n(p);m=t?c.concat(m):m.concat(c),C=h(p)}}return{breadthFirstTraverse:r,depthFirstTraverse:b}}function Se(){function l(a){return e.unref(a).treeNodeSpec.expandable===!0}function n(a){return e.unref(a).treeNodeSpec.state.expanded===!0}return{isExpandable:l,isExpanded:n}}function R(){const{isExpanded:l}=Se(),{getFilteredChildren:n,getFilteredNodes:a}=W();function r(C,p=!1){e.unref(C).treeNodeSpec._.keepCurrentDomFocus=p,e.unref(C).treeNodeSpec.focusable=!0}function b(C){e.unref(C).treeNodeSpec.focusable=!1}function s(C){return e.unref(C).treeNodeSpec.focusable===!0}function h(C,p=!1){const c=a(C);c.length>0&&r(c[0],p)}function t(C,p=!1){const c=a(C);let N=c[c.length-1],S=n(N);for(;S.length>0&&l(N);)N=S[S.length-1],S=n(N);r(N,p)}function o(C,p,c,N=!1){const S=a(C);let f=S.findIndex(v=>v[v.treeNodeSpec.idProperty]===p[p.treeNodeSpec.idProperty]),d=n(p);if(!c&&d.length>0&&l(p))r(d[0],N);else if(f<S.length-1)r(S[f+1],N);else return!1;return!0}function m(C,p,c=!1){const N=a(C);let S=N.findIndex(f=>f[f.treeNodeSpec.idProperty]===p[p.treeNodeSpec.idProperty]);if(S!==0){let f=N[S-1],d=n(f);for(;d.length>0&&l(f);)f=d[d.length-1],d=n(f);return r(f,c),!0}return!1}return{focus:r,focusFirst:h,focusLast:t,focusNext:o,focusPrevious:m,isFocused:s,unfocus:b}}function Le(){const{unfocus:l}=R(),n=e.ref(null);function a(r){n.value!==r&&(n.value&&l(n),n.value=r)}return{focusableNodeModel:n,handleFocusableChange:a}}function X(){function l(s){e.unref(s).treeNodeSpec.state.selected=!0}function n(s){e.unref(s).treeNodeSpec.state.selected=!1}function a(s,h){e.unref(s).treeNodeSpec.state.selected=h}function r(s){return e.unref(s).treeNodeSpec.selectable===!0}function b(s){return e.unref(s).treeNodeSpec.state.selected===!0}return{deselect:n,isSelectable:r,isSelected:b,setSelected:a,select:l}}function qe(l){const{getFilteredNodes:n}=W(),{focusFirst:a}=R();let r=n(l).length===0;return e.watch(()=>n(l),()=>{n(l).length>0?(r&&a(l,!0),r=!1):r=!0}),{}}const i=Object.freeze({RootNodesLoad:"treeRootNodesLoad",Click:"treeNodeClick",DoubleClick:"treeNodeDblclick",CheckboxChange:"treeNodeCheckboxChange",ChildCheckboxChange:"treeNodeChildCheckboxChange",RadioChange:"treeNodeRadioChange",ExpandedChange:"treeNodeExpandedChange",ChildrenLoad:"treeNodeChildrenLoad",SelectedChange:"treeNodeSelectedChange",FocusableChange:"treeNodeAriaFocusableChange",RequestFirstFocus:"treeNodeAriaRequestFirstFocus",RequestLastFocus:"treeNodeAriaRequestLastFocus",RequestParentFocus:"treeNodeAriaRequestParentFocus",RequestPreviousFocus:"treeNodeAriaRequestPreviousFocus",RequestNextFocus:"treeNodeAriaRequestNextFocus",Add:"treeNodeAdd",Delete:"treeNodeDelete",DragMove:"treeNodeDragMove",Drop:"treeNodeDrop"});function $e(l,n,a,r){const{depthFirstTraverse:b}=ie(l),{deselect:s,isSelectable:h,isSelected:t,select:o}=X();e.watch(n,C),e.watch(a,f=>{e.unref(n)===E.SelectionFollowsFocus&&S(f)});const m=e.computed(()=>n.value===E.None?null:n.value===E.Multiple);function C(){e.unref(n)===E.Single?p():e.unref(n)===E.SelectionFollowsFocus&&c()}function p(){let f=!1;b(d=>{d.treeNodeSpec.state&&t(d)&&(f?s(d):f=!0)})}function c(){b(f=>{let d=f.treeNodeSpec.idProperty,v=a.value.treeNodeSpec.idProperty;f[d]===a.value[v]?h(f)&&o(f):t(f)&&s(f)})}function N(f){e.unref(n)===E.Single&&t(f)&&S(f),r(i.SelectedChange,f)}function S(f){const d=f[f.treeNodeSpec.idProperty];b(v=>t(v)&&v[v.treeNodeSpec.idProperty]!==d?(s(v),!1):!0)}return{ariaMultiselectable:m,enforceSelectionMode:C,handleNodeSelectedChange:N}}const ve=Object.freeze({None:"none",Copy:"copy",Move:"move",Link:"link"}),M=Object.freeze({None:"none",All:"all",Copy:"copy",Move:"move",Link:"link",CopyMove:"copyMove",CopyLink:"copyLink",LinkMove:"linkMove"}),O=Object.freeze({Before:0,After:1,Child:2});function ke(){function l(a){return a!==null&&typeof a=="object"&&!Array.isArray(a)}function n(a){let r=JSON.parse(JSON.stringify(a));if(l(r))for(const b of Object.keys(a)){let s=a[b];typeof s=="function"?r[b]=s:l(s)&&(r[b]=n(s))}return r}return{isProbablyObject:l,cheapCopyObject:n}}const{resolveNodeIdConflicts:xe}=be(),{cheapCopyObject:Oe}=ke(),{unfocus:ze}=R();function Be(l,n,a,r){function b(h){const t=l.value.indexOf(h);t>-1&&l.value.splice(t,1)}function s(h){let t=h.droppedModel;if(h.isSameTree)if(h.dropEffect===ve.Move)t=r(t[t.treeNodeSpec.idProperty]),t.treeNodeSpec._.dragMoved=!0;else{let o=a(t[t.treeNodeSpec.idProperty]);t=Oe(o),xe(t,n.value),ze(t)}else xe(t,n.value);if(t){let o=h.siblingNodeSet||l.value,m=o.indexOf(h.targetModel);switch(h.targetZone){case O.Before:o.splice(m,0,t);break;case O.After:o.splice(m+1,0,t);break;default:o.push(t);break}t.treeNodeSpec._.dragging=!1}}return{dragMoveNode:b,drop:s}}const j=Object.freeze({Checkbox:"checkbox",RadioButton:"radio"});function Me(l,n,a){const{depthFirstTraverse:r}=ie(l),{isSelectable:b,isSelected:s}=X();function h(c,N=0){let S=[];return typeof c=="function"&&r(f=>{if(c(f))return S.push(f),N<1||S.length<N}),S}function t(){return h(c=>c.treeNodeSpec.input&&c.treeNodeSpec.input.type===j.Checkbox&&c.treeNodeSpec.state.input.value)}function o(){return h(c=>c.treeNodeSpec.input&&c.treeNodeSpec.input.type===j.RadioButton&&n.value[c.treeNodeSpec.input.name]===c.treeNodeSpec.input.value)}function m(c){let N=null;return typeof c=="string"&&(N=l.value.find(S=>S[S.treeNodeSpec.idProperty]===c),N||r(S=>{if(N=S[S.treeNodeSpec.childrenProperty].find(d=>d[d.treeNodeSpec.idProperty]===c),N)return!1})),N}function C(){return a.value===E.None?[]:h(c=>b(c)&&s(c))}function p(c){let N=null;if(typeof c=="string"){let S=l.value.findIndex(f=>f[f.treeNodeSpec.idProperty]===c);S>-1?N=l.value.splice(S,1)[0]:r(f=>{let d=f[f.treeNodeSpec.childrenProperty];if(S=d.findIndex(v=>v[v.treeNodeSpec.idProperty]===c),S>-1)return N=d.splice(S,1)[0],!1})}return N}return{findById:m,getCheckedCheckboxes:t,getCheckedRadioButtons:o,getMatching:h,getSelected:C,removeById:p}}const{isProbablyObject:Te}=ke(),je=[M.Copy,M.Move,M.CopyMove,M.None];function Ke(l,n,a){function r(){l.value.treeNodeSpec||(l.value.treeNodeSpec={});const t=l.value.treeNodeSpec;b(e.unref(n),t),typeof t.childrenProperty!="string"&&(t.childrenProperty="children"),typeof t.idProperty!="string"&&(t.idProperty="id"),typeof t.labelProperty!="string"&&(t.labelProperty="label"),Array.isArray(l.value[t.childrenProperty])||(l.value[t.childrenProperty]=[]),typeof t.expandable!="boolean"&&(t.expandable=!0),typeof t.selectable!="boolean"&&(t.selectable=!1),typeof t.deletable!="boolean"&&(t.deletable=!1),typeof t.draggable!="boolean"&&(t.draggable=!1),typeof t.allowDrop!="boolean"&&(t.allowDrop=!1),(typeof t.dataTransferEffectAllowed!="string"||!je.includes(t.dataTransferEffectAllowed))&&(t.dataTransferEffectAllowed=M.CopyMove),typeof t.focusable!="boolean"&&(t.focusable=!1),typeof t.addChildCallback!="function"&&(t.addChildCallback=null),typeof t.deleteNodeCallback!="function"&&(t.deleteNodeCallback=null),(typeof t.title!="string"||t.title.trim().length===0)&&(t.title=null),(typeof t.expanderTitle!="string"||t.expanderTitle.trim().length===0)&&(t.expanderTitle=null),(typeof t.addChildTitle!="string"||t.addChildTitle.trim().length===0)&&(t.addChildTitle=null),(typeof t.deleteTitle!="string"||t.deleteTitle.trim().length===0)&&(t.deleteTitle=null),(t.customizations==null||typeof t.customizations!="object")&&(t.customizations={}),typeof t.loadChildrenAsync!="function"&&(t.loadChildrenAsync=null),t._={},t._.dragging=!1,s(t),h(t),l.value.treeNodeSpec=t}function b(t,o){if(Te(t)){const m=JSON.parse(JSON.stringify(t));Object.assign(m,o);for(const C of Object.keys(t)){const p=typeof t[C]=="function"?t[C]:m[C];Te(p)?(o[C]=o[C]||{},b(p,o[C])):(typeof p=="function"&&o[C],o[C]=p)}}}function s(t){let o=t.input;o===null||typeof o!="object"||!Object.values(j).includes(o.type)?t.input=null:((typeof o.name!="string"||o.name.trim().length===0)&&(o.name=null),o.type===j.RadioButton&&((typeof o.name!="string"||o.name.trim().length===0)&&(o.name="unspecifiedRadioName"),(typeof o.value!="string"||o.value.trim().length===0)&&(o.value=l.value[t.labelProperty].replace(/[\s&<>"'\/]/g,"")),a.value.hasOwnProperty(o.name)||(a.value[o.name]=""),o.isInitialRadioGroupValue===!0&&(a.value[o.name]=o.value)))}function h(t){(t.state===null||typeof t.state!="object")&&(t.state={}),(t._.state===null||typeof t._.state!="object")&&(t._.state={});let o=t.state,m=t._.state;m.areChildrenLoaded=typeof t.loadChildrenAsync!="function",m.areChildrenLoading=!1,(typeof o.expanded!="boolean"||!m.areChildrenLoaded)&&(o.expanded=!1),typeof o.selected!="boolean"&&(o.selected=!1),t.input&&((o.input===null||typeof o.input!="object")&&(o.input={}),(o.input.disabled===null||typeof o.input.disabled!="boolean")&&(o.input.disabled=!1),t.input.type===j.Checkbox&&typeof o.input.value!="boolean"&&(o.input.value=!1))}return{normalizeNodeData:r}}function se(l,n){const{getChildren:a}=ae(),r=e.computed(()=>typeof l.value.treeNodeSpec.loadChildrenAsync!="function"||l.value.treeNodeSpec._.state.areChildrenLoaded),b=e.computed(()=>l.value.treeNodeSpec._.state.areChildrenLoading),s=e.computed(()=>a(l)),h=e.computed(()=>s.value&&s.value.length>0),t=e.computed(()=>h.value||!r.value);async function o(){const p=l.value.treeNodeSpec;if(!p._.state.areChildrenLoaded&&!p._.state.areChildrenLoading){p._.state.areChildrenLoading=!0;var c=await p.loadChildrenAsync(l.value);c&&(p._.state.areChildrenLoaded=!0,s.value.splice(0,s.value.length,...c),n(i.ChildrenLoad,l.value)),p._.state.areChildrenLoading=!1}}async function m(){if(l.value.treeNodeSpec.addChildCallback){var p=await l.value.treeNodeSpec.addChildCallback(l.value);p&&(s.value.push(p),n(i.Add,p,l.value))}}function C(p){let c=s.value.indexOf(p);c>-1&&(s.value.splice(c,1),n(i.Delete,p))}return{addChild:m,areChildrenLoaded:r,areChildrenLoading:b,children:s,deleteChild:C,hasChildren:h,loadChildren:o,mayHaveChildren:t}}const K=Object.freeze({Json:"application/json",PlainText:"text/plain",TreeViewNode:"application/x-grapoza-treeviewnode"});function He(){function l(n,a){return(n.closest?n:n.parentElement).closest(a)}return{closest:l}}const{closest:Je}=He();function Ge(l,n,a,r){const{unfocus:b}=R(),s=l.value.treeNodeSpec;function h(d){const v=n.value.indexOf(d);v>-1&&n.value.splice(v,1)}function t(d,v){d.siblingNodeSet=d.siblingNodeSet||n.value,r(i.Drop,d,v)}function o(d){d.stopPropagation();let v=JSON.parse(JSON.stringify(l.value));b(v),v=JSON.stringify(v),s._.dragging=!0,d.dataTransfer.effectAllowed=s.dataTransferEffectAllowed,d.dataTransfer.setData(K.TreeViewNode,`{"treeId":"${a.value}","data":${v}}`),d.dataTransfer.setData(K.Json,v),d.dataTransfer.setData(K.PlainText,v)}function m(d){S(d)&&(f(d,!0),d.preventDefault())}function C(d){S(d)&&(f(d,!0),d.preventDefault())}function p(d){S(d)&&f(d,!1)}function c(d){const v=JSON.parse(d.dataTransfer.getData(K.TreeViewNode)),y=d.target.classList.contains("grtvn-self-prev-target")?O.Before:d.target.classList.contains("grtvn-self-next-target")?O.After:O.Child,P={isSameTree:v.treeId===a.value,droppedModel:v.data,targetModel:l.value,siblingNodeSet:y===O.Child?n.value:null,dropEffect:d.dataTransfer.dropEffect,targetZone:y};r(i.Drop,P,d),f(d,!1),d.preventDefault()}function N(d){d.dataTransfer.dropEffect===ve.Move?s._.dragMoved?delete s._.dragMoved:r(i.DragMove,l.value,d):(f(d,!1),s._.dragging=!1)}function S(d){return s.allowDrop&&d.dataTransfer.types.includes(K.TreeViewNode)&&!Je(d.target,".grtvn-dragging")}function f(d,v){const y=d.target.classList&&d.target.classList.contains("grtvn-self-prev-target"),P=d.target.classList&&d.target.classList.contains("grtvn-self-next-target");s._.isDropTarget=v,y?(s._.isPrevDropTarget=v,s._.isChildDropTarget=!1):P?(s._.isNextDropTarget=v,s._.isChildDropTarget=!1):s._.isChildDropTarget=v}return{dragMoveChild:h,drop:t,onDragstart:o,onDragenter:m,onDragover:C,onDragleave:p,onDrop:c,onDragend:N}}function Ue(l,n,a,r){const{focus:b,focusFirst:s,focusLast:h,focusNext:t,focusPrevious:o,isFocused:m,unfocus:C}=R(),{getChildren:p}=ae(),c=e.computed(()=>p(l));e.watch(()=>l.value.treeNodeSpec.focusable,function(I){I===!0&&(r.value&&!l.value.treeNodeSpec._.keepCurrentDomFocus&&n.value.focus(),delete l.value.treeNodeSpec._.keepCurrentDomFocus,a(i.FocusableChange,l.value))});function N(I=!1){b(l,I)}function S(){C(l)}function f(){return m(l)}function d(I=!1){s(c.value,I)}function v(I=!1){h(c.value,I)}function y(I,A,H=!1){t(c.value,I,A,H)||a(i.RequestNextFocus,e.unref(l),!0)}function P(I,A=!1){o(c.value,I,A)||N(A)}return{focusNode:N,unfocusNode:S,isFocusedNode:f,focusFirstChild:d,focusLastChild:v,focusNextNode:y,focusPreviousNode:P}}function Ze(l,n,a){const{deselect:r,isSelectable:b,isSelected:s,setSelected:h,select:t}=X();e.watch(()=>l.value.treeNodeSpec.state.selected,()=>{a(i.SelectedChange,l.value)}),e.watch(()=>l.value.treeNodeSpec.focusable,function(f){c()&&n.value===E.SelectionFollowsFocus&&C(f)});function o(){t(l)}function m(){r(l)}function C(f){h(l,f)}function p(){b(l)&&[E.Single,E.Multiple].includes(n.value)&&h(l,!N())}function c(){return b(l)}function N(){return s(l)}return{ariaSelected:e.computed(()=>n.value===E.None||!c()?null:n.value!==E.Multiple?N()?!0:null:N()),deselectNode:m,isNodeSelectable:c,isNodeSelected:N,setNodeSelected:C,selectNode:o,toggleNodeSelected:p}}function Fe(l,n){const a=e.inject("filterMethod"),{isFocused:r,unfocus:b}=R(),{areChildrenLoaded:s}=se(l),{getFilteredChildren:h}=W(),t=e.computed(()=>h(l)),o=e.computed(()=>typeof e.unref(a)=="function"),m=e.computed(()=>l.value.treeNodeSpec._.state.matchesFilter||l.value.treeNodeSpec._.state.subnodeMatchesFilter||!1),C=e.computed(()=>t.value&&t.value.length>0),p=e.computed(()=>C.value||!s.value);return e.watchEffect(()=>{const c=l.value.treeNodeSpec;c._.state.matchesFilter=!o.value||e.unref(a)(l.value),c._.state.subnodeMatchesFilter=t.value.length>0,!m.value&&r(l)&&(b(l),n(i.RequestFirstFocus,!0))}),{filteredChildren:t,filterIncludesNode:m,isFilteringEnabled:o,mayHaveFilteredChildren:p}}function Qe(l,n){const{isExpandable:a,isExpanded:r}=Se(),{loadChildren:b}=se(l,n),{mayHaveFilteredChildren:s}=Fe(l,n),h=e.computed(()=>t.value?m():null),t=e.computed(()=>o()&&s.value);e.watch(()=>l.value.treeNodeSpec.state.expanded,async function(){n(i.ExpandedChange,l.value),m()&&await b()});function o(){return a(l)}function m(){return r(l)}function C(){return t.value&&m()?(l.value.treeNodeSpec.state.expanded=!1,!0):!1}function p(){return t.value&&!m()?(l.value.treeNodeSpec.state.expanded=!0,!0):!1}function c(){return m()?C():p()}return{ariaExpanded:h,canExpand:t,collapseNode:C,expandNode:p,isNodeExpandable:o,isNodeExpanded:m,toggleNodeExpanded:c}}const ht="",We=["id","tabindex","aria-expanded","aria-selected"],Xe=["draggable","dragging"],Ye=["id","title"],_e=["for","title"],et=["id","disabled"],tt=["for","title"],lt=["id","name","value","disabled"],ot=["title"],nt=["id","title"],rt=["id","title"],at=["aria-hidden"],we="input, .grtvn-self-expander, .grtvn-self-expander *, .grtvn-self-action, .grtvn-self-action *",it={__name:"TreeViewNode",props:{ariaKeyMap:{type:Object,required:!0},depth:{type:Number,required:!0},initialModel:{type:Object,required:!0},initialRadioGroupValues:{type:Object,required:!0},isMounted:{type:Boolean,required:!0},modelDefaults:{type:Object,required:!0},selectionMode:{type:String,required:!1,default:E.None,validator:function(l){return Object.values(E).includes(l)}},treeId:{type:String,required:!0}},emits:[i.Add,i.Click,i.CheckboxChange,i.ChildCheckboxChange,i.ChildrenLoad,i.Delete,i.DoubleClick,i.DragMove,i.Drop,i.ExpandedChange,i.FocusableChange,i.RadioChange,i.RequestFirstFocus,i.RequestLastFocus,i.RequestNextFocus,i.RequestParentFocus,i.RequestPreviousFocus,i.SelectedChange],setup(l,{emit:n}){const a=l,r=e.ref(a.initialModel),b=e.ref(a.initialRadioGroupValues),s=e.ref(null),h=e.computed(()=>`${v.value}-add-child`),t=e.computed(()=>Ce()?0:-1),o=e.computed(()=>{var u,g;return(g=(u=y.value.customizations)==null?void 0:u.classes)!=null?g:{}}),m=e.computed(()=>`${v.value}-delete`),C=e.computed(()=>`${v.value}-exp`),p=e.computed(()=>r.value[c.value]),c=e.computed(()=>{var u;return(u=y.value.idProperty)!=null?u:"id"}),N=e.computed(()=>`${v.value}-input`),S=e.computed(()=>a.selectionMode!==E.None&&Ne()&&he()),f=e.computed(()=>r.value[d.value]),d=e.computed(()=>{var u;return(u=y.value.labelProperty)!=null?u:"label"}),v=e.computed(()=>`${a.treeId}-${p.value}`),y=e.computed(()=>r.value.treeNodeSpec),P=e.computed(()=>a.treeId),{normalizeNodeData:I}=Ke(r,a.modelDefaults,b);I();const{addChild:A,areChildrenLoaded:H,areChildrenLoading:Y,children:J,deleteChild:de,hasChildren:ue}=se(r,n),{filteredChildren:z,filterIncludesNode:ce,mayHaveFilteredChildren:fe}=Fe(r,n),{focus:pe,isFocused:ge}=R(),{focusNode:_,focusNextNode:ee,focusPreviousNode:te,isFocusedNode:Ce}=Ue(r,s,n,e.toRef(a,"isMounted")),{ariaSelected:G,isNodeSelectable:Ne,isNodeSelected:he,toggleNodeSelected:le}=Ze(r,e.toRef(a,"selectionMode"),n),{ariaExpanded:me,canExpand:x,collapseNode:k,expandNode:U,isNodeExpanded:oe,toggleNodeExpanded:Z}=Qe(r,n),{dragMoveChild:T,drop:D,onDragstart:L,onDragenter:B,onDragover:ne,onDragleave:De,onDrop:Ee,onDragend:Ve}=Ge(r,J,P,n);function Ie(u){n(i.CheckboxChange,r.value,u)}function Pe(u){n(i.RadioChange,r.value,u)}function ct(u){u.target.matches(we)||(n(i.Click,r.value,u),le()),_()}function ft(u){u.target.matches(we)||n(i.DoubleClick,r.value,u)}async function Ae(u){var g,$,F;y.value.deletable&&((F=await(($=(g=y.value).deleteNodeCallback)==null?void 0:$.call(g,r.value)))!=null?F:!0)&&n(i.Delete,r.value)}function pt(u){let g=!0;if(!(u.altKey||u.ctrlKey||u.metaKey||u.shift)){if(a.ariaKeyMap.activateItem.includes(u.keyCode)){if(y.value.input&&!y.value.state.input.disabled){let $=s.value.querySelector(".grtvn-self"),F=$.querySelector(".grtvn-self-input")||$.querySelector("input");if(F){let re=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});F.dispatchEvent(re)}}}else a.ariaKeyMap.selectItem.includes(u.keyCode)?le():a.ariaKeyMap.expandFocusedItem.includes(u.keyCode)?fe.value&&!Y.value&&!U()&&oe()&&pe(z.value[0]):a.ariaKeyMap.collapseFocusedItem.includes(u.keyCode)?k()||n(i.RequestParentFocus):a.ariaKeyMap.focusFirstItem.includes(u.keyCode)?n(i.RequestFirstFocus):a.ariaKeyMap.focusLastItem.includes(u.keyCode)?n(i.RequestLastFocus):a.ariaKeyMap.focusPreviousItem.includes(u.keyCode)?n(i.RequestPreviousFocus,r.value):a.ariaKeyMap.focusNextItem.includes(u.keyCode)?n(i.RequestNextFocus,r.value,!1):a.ariaKeyMap.insertItem.includes(u.keyCode)?A():a.ariaKeyMap.deleteItem.includes(u.keyCode)?Ae():g=!1;g&&(u.stopPropagation(),u.preventDefault())}}function gt(u){z.value.indexOf(u)>-1&&(ge(u)&&(z.value.length>1&&z.value.indexOf(u)===0?ee(u):te(u)),de(u))}function Ct(u,g){n(i.CheckboxChange,u,g),J.value.includes(u)&&n(i.ChildCheckboxChange,r.value,u,g)}return(!p.value||typeof p.value!="number"&&typeof p.value!="string")&&console.error(`initialModel id is required and must be a number or string. Expected prop ${c.value} to exist on the model.`),(!f.value||typeof f.value!="string")&&console.error(`initialModel label is required and must be a string. Expected prop ${d.value} to exist on the model.`),(u,g)=>{const $=e.resolveComponent("TreeViewNode",!0);return e.openBlock(),e.createElementBlock("li",{id:v.value,ref_key:"nodeElement",ref:s,class:e.normalizeClass(["grtvn",[o.value.treeViewNode,y.value._.dragging?"grtvn-dragging":"",e.unref(ce)?"":"grtvn-hidden"]]),role:"treeitem",tabindex:t.value,"aria-expanded":e.unref(me),"aria-selected":e.unref(G),onKeydown:pt},[e.createElementVNode("div",{class:e.normalizeClass(["grtvn-self",[o.value.treeViewNodeSelf,S.value?"grtvn-self-selected":"",S.value?o.value.treeViewNodeSelfSelected:"",y.value._.isDropTarget?"grtvn-self-drop-target":"",y.value._.isChildDropTarget?"grtvn-self-child-drop-target":""]]),draggable:y.value.draggable,dragging:y.value._.dragging,onClick:ct,onDblclick:ft,onDragend:g[4]||(g[4]=(...F)=>e.unref(Ve)&&e.unref(Ve)(...F)),onDragenter:g[5]||(g[5]=(...F)=>e.unref(B)&&e.unref(B)(...F)),onDragleave:g[6]||(g[6]=(...F)=>e.unref(De)&&e.unref(De)(...F)),onDragover:g[7]||(g[7]=(...F)=>e.unref(ne)&&e.unref(ne)(...F)),onDragstart:g[8]||(g[8]=(...F)=>e.unref(L)&&e.unref(L)(...F)),onDrop:g[9]||(g[9]=(...F)=>e.unref(Ee)&&e.unref(Ee)(...F))},[e.createElementVNode("div",{class:e.normalizeClass(["grtvn-self-sibling-drop-target grtvn-self-prev-target",[y.value._.isPrevDropTarget?"grtvn-self-sibling-drop-target-hover":""]])},null,2),e.unref(x)?(e.openBlock(),e.createElementBlock("button",{key:0,id:C.value,type:"button","aria-hidden":"true",tabindex:"-1",title:y.value.expanderTitle,class:e.normalizeClass(["grtvn-self-expander",[o.value.treeViewNodeSelfExpander,y.value.state.expanded?"grtvn-self-expanded":"",y.value.state.expanded?o.value.treeViewNodeSelfExpanded:""]]),onClick:g[0]||(g[0]=(...F)=>e.unref(Z)&&e.unref(Z)(...F))},[e.createElementVNode("i",{class:e.normalizeClass(["grtvn-self-expanded-indicator",o.value.treeViewNodeSelfExpandedIndicator])},null,2)],10,Ye)):(e.openBlock(),e.createElementBlock("span",{key:1,class:e.normalizeClass(["grtvn-self-spacer",o.value.treeViewNodeSelfSpacer])},null,2)),y.value.input&&y.value.input.type==="checkbox"?e.renderSlot(u.$slots,"checkbox",{key:2,model:r.value,customClasses:o.value,inputId:N.value,checkboxChangeHandler:Ie},()=>[e.createElementVNode("label",{for:N.value,title:y.value.title,class:e.normalizeClass(["grtvn-self-label",o.value.treeViewNodeSelfLabel])},[e.withDirectives(e.createElementVNode("input",{id:N.value,tabindex:"-1",class:e.normalizeClass(["grtvn-self-input grtvn-self-checkbox",[o.value.treeViewNodeSelfInput,o.value.treeViewNodeSelfCheckbox]]),type:"checkbox",disabled:y.value.state.input.disabled,"onUpdate:modelValue":g[1]||(g[1]=F=>y.value.state.input.value=F),onChange:Ie},null,42,et),[[e.vModelCheckbox,y.value.state.input.value]]),e.createTextVNode(" "+e.toDisplayString(f.value),1)],10,_e)]):y.value.input&&y.value.input.type==="radio"?e.renderSlot(u.$slots,"radio",{key:3,model:r.value,customClasses:o.value,inputId:N.value,radioGroupValues:b.value,radioChangeHandler:Pe},()=>[e.createElementVNode("label",{for:N.value,title:y.value.title,class:e.normalizeClass(["grtvn-self-label",o.value.treeViewNodeSelfLabel])},[e.withDirectives(e.createElementVNode("input",{id:N.value,tabindex:"-1",class:e.normalizeClass(["grtvn-self-input grtvn-self-radio",[o.value.treeViewNodeSelfInput,o.value.treeViewNodeSelfRadio]]),type:"radio",name:y.value.input.name,value:y.value.input.value,disabled:y.value.state.input.disabled,"onUpdate:modelValue":g[2]||(g[2]=F=>b.value[y.value.input.name]=F),onChange:Pe},null,42,lt),[[e.vModelRadio,b.value[y.value.input.name]]]),e.createTextVNode(" "+e.toDisplayString(f.value),1)],10,tt)]):e.renderSlot(u.$slots,"text",{key:4,model:r.value,customClasses:o.value},()=>[e.createElementVNode("span",{title:y.value.title,class:e.normalizeClass(["grtvn-self-text",o.value.treeViewNodeSelfText])},e.toDisplayString(f.value),11,ot)]),y.value.addChildCallback?(e.openBlock(),e.createElementBlock("button",{key:5,id:h.value,type:"button","aria-hidden":"true",tabindex:"-1",title:y.value.addChildTitle,class:e.normalizeClass(["grtvn-self-action",[o.value.treeViewNodeSelfAction,o.value.treeViewNodeSelfAddChild]]),onClick:g[3]||(g[3]=(...F)=>e.unref(A)&&e.unref(A)(...F))},[e.createElementVNode("i",{class:e.normalizeClass(["grtvn-self-add-child-icon",o.value.treeViewNodeSelfAddChildIcon])},null,2)],10,nt)):e.createCommentVNode("",!0),y.value.deletable?(e.openBlock(),e.createElementBlock("button",{key:6,id:m.value,type:"button","aria-hidden":"true",tabindex:"-1",title:y.value.deleteTitle,class:e.normalizeClass(["grtvn-self-action",[o.value.treeViewNodeSelfAction,o.value.treeViewNodeSelfDelete]]),onClick:Ae},[e.createElementVNode("i",{class:e.normalizeClass(["grtvn-self-delete-icon",o.value.treeViewNodeSelfDeleteIcon])},null,2)],10,rt)):e.createCommentVNode("",!0),e.createElementVNode("div",{class:e.normalizeClass(["grtvn-self-sibling-drop-target grtvn-self-next-target",[y.value._.isNextDropTarget?"grtvn-self-sibling-drop-target-hover":""]])},null,2)],42,Xe),e.createElementVNode("div",{class:e.normalizeClass(["grtvn-children-wrapper",o.value.treeViewNodeChildrenWrapper])},[y.value.state.expanded&&!e.unref(H)?e.renderSlot(u.$slots,"loading",{key:0,model:r.value,customClasses:o.value},()=>[e.createElementVNode("span",{class:e.normalizeClass(["grtvn-loading",o.value.treeViewNodeLoading])}," ... ",2)]):e.createCommentVNode("",!0),e.unref(ue)?e.withDirectives((e.openBlock(),e.createElementBlock("ul",{key:1,class:e.normalizeClass(["grtvn-children",o.value.treeViewNodeChildren]),role:"group","aria-hidden":!y.value.state.expanded},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(J),F=>{var re,Re;return e.openBlock(),e.createBlock($,{key:F[(Re=(re=F.treeNodeSpec)==null?void 0:re.idProperty)!=null?Re:"id"],depth:l.depth+1,"initial-model":F,"model-defaults":l.modelDefaults,"parent-id":p.value,"selection-mode":l.selectionMode,"tree-id":P.value,"initial-radio-group-values":b.value,"aria-key-map":l.ariaKeyMap,"is-mounted":l.isMounted,onTreeNodeClick:g[10]||(g[10]=(w,V)=>u.$emit(e.unref(i).Click,w,V)),onTreeNodeDblclick:g[11]||(g[11]=(w,V)=>u.$emit(e.unref(i).DoubleClick,w,V)),onTreeNodeCheckboxChange:Ct,onTreeNodeChildCheckboxChange:g[12]||(g[12]=(w,V,Q)=>u.$emit(e.unref(i).ChildCheckboxChange,w,V,Q)),onTreeNodeRadioChange:g[13]||(g[13]=(w,V)=>u.$emit(e.unref(i).RadioChange,w,V)),onTreeNodeExpandedChange:g[14]||(g[14]=w=>u.$emit(e.unref(i).ExpandedChange,w)),onTreeNodeChildrenLoad:g[15]||(g[15]=w=>u.$emit(e.unref(i).ChildrenLoad,w)),onTreeNodeSelectedChange:g[16]||(g[16]=w=>u.$emit(e.unref(i).SelectedChange,w)),onTreeNodeAdd:g[17]||(g[17]=(w,V)=>u.$emit(e.unref(i).Add,w,V)),onTreeNodeDelete:gt,onTreeNodeAriaFocusableChange:g[18]||(g[18]=w=>u.$emit(e.unref(i).FocusableChange,w)),onTreeNodeAriaRequestParentFocus:g[19]||(g[19]=()=>e.unref(_)()),onTreeNodeAriaRequestFirstFocus:g[20]||(g[20]=w=>u.$emit(e.unref(i).RequestFirstFocus,w)),onTreeNodeAriaRequestLastFocus:g[21]||(g[21]=()=>u.$emit(e.unref(i).RequestLastFocus)),onTreeNodeAriaRequestPreviousFocus:e.unref(te),onTreeNodeAriaRequestNextFocus:e.unref(ee),onTreeNodeDragMove:e.unref(T),onTreeNodeDrop:e.unref(D)},{checkbox:e.withCtx(({model:w,customClasses:V,inputId:Q,checkboxChangeHandler:ye})=>[e.renderSlot(u.$slots,"checkbox",{model:w,customClasses:V,inputId:Q,checkboxChangeHandler:ye})]),radio:e.withCtx(({model:w,customClasses:V,inputId:Q,radioGroupValues:ye,radioChangeHandler:Nt})=>[e.renderSlot(u.$slots,"radio",{model:w,customClasses:V,inputId:Q,radioGroupValues:ye,radioChangeHandler:Nt})]),text:e.withCtx(({model:w,customClasses:V})=>[e.renderSlot(u.$slots,"text",{model:w,customClasses:V})]),loading:e.withCtx(({model:w,customClasses:V})=>[e.renderSlot(u.$slots,"loading",{model:w,customClasses:V})]),_:2},1032,["depth","initial-model","model-defaults","parent-id","selection-mode","tree-id","initial-radio-group-values","aria-key-map","is-mounted","onTreeNodeAriaRequestPreviousFocus","onTreeNodeAriaRequestNextFocus","onTreeNodeDragMove","onTreeNodeDrop"])}),128))],10,at)),[[e.vShow,y.value.state.expanded]]):e.createCommentVNode("",!0)],2)],42,We)}}},mt="",st=e.createElementVNode("span",{class:"grtv-loading"}," ... ",-1),dt=["aria-multiselectable"],ut={__name:"TreeView",props:{customAriaKeyMap:{type:Object,required:!1,default:function(){return{}},validator:function(l){for(const n in l)if(!Array.isArray(l[n])||l[n].some(a=>!Number.isInteger(a)))return console.error(`customAriaKeyMap properties must be Arrays of numbers (corresponding to keyCodes); property '${n}' fails check.`),!1;return!0}},filterMethod:{type:Function,required:!1,default:null},initialModel:{type:Array,required:!1,default:function(){return[]}},loadNodesAsync:{type:Function,required:!1,default:null},modelDefaults:{type:Object,required:!1,default:function(){return{}}},selectionMode:{type:String,required:!1,default:E.None,validator:function(l){return Object.values(E).includes(l)}},skinClass:{type:String,required:!1,default:"grtv-default-skin",validator:function(l){return l===null||!l.match(/\s/)}}},emits:[i.Add,i.CheckboxChange,i.ChildrenLoad,i.ChildCheckboxChange,i.Click,i.Delete,i.DoubleClick,i.ExpandedChange,i.RadioChange,i.RootNodesLoad,i.SelectedChange],setup(l,{expose:n,emit:a}){const r=l,b=e.readonly({activateItem:[32],selectItem:[13],focusLastItem:[35],focusFirstItem:[36],collapseFocusedItem:[37],expandFocusedItem:[39],focusPreviousItem:[38],focusNextItem:[40],insertItem:[45],deleteItem:[46]}),s=e.ref(!1),h=e.ref(!1),t=e.ref(r.initialModel),o=e.ref({}),m=e.ref(""),C=e.ref(null),{generateUniqueId:p}=be(),{depthFirstTraverse:c}=ie(t),{focusableNodeModel:N,handleFocusableChange:S}=Le(),{focus:f,focusFirst:d,focusLast:v,focusNext:y,focusPrevious:P,isFocused:I,unfocus:A}=R(),{ariaMultiselectable:H,enforceSelectionMode:Y,handleNodeSelectedChange:J}=$e(t,e.toRef(r,"selectionMode"),N,a),{isSelectable:de,isSelected:ue,select:z}=X(e.toRef(r,"selectionMode")),{findById:ce,getCheckedCheckboxes:fe,getCheckedRadioButtons:pe,getMatching:ge,getSelected:_,removeById:ee}=Me(t,o,e.toRef(r,"selectionMode")),{dragMoveNode:te,drop:Ce}=Be(t,m,ce,ee);qe(t);const G=e.computed(()=>typeof r.loadNodesAsync!="function"||s.value),Ne=e.computed(()=>Object.assign({},b,r.customAriaKeyMap));e.onMounted(async()=>{if(await he(),C.value.id&&(m.value=C.value.id),t.value.length>0){let x=null;c(k=>{I(k)&&(N.value?A(k):N.value=k),r.selectionMode!==E.None&&x===null&&ue(k)&&(x=k)}),N.value||(N.value=x||t.value[0],f(N)),x===null&&de(N)&&r.selectionMode===E.SelectionFollowsFocus&&z(N),Y()}e.nextTick(()=>{r.selectionMode===E.Single&&Y(),h.value=!0})});async function he(){if(!G.value){var x=await r.loadNodesAsync();x&&(s.value=!0,t.value.splice(0,t.value.length,...x),a(i.RootNodesLoad,t.value))}}function le(x){let k=t.value.indexOf(x);k>-1&&(me(x),t.value.splice(k,1)),a(i.Delete,x)}function me(x){I(x)&&(t.value.indexOf(x)===0?t.value.length>0&&y(t.value,x):P(t.value,x))}return e.provide("filterMethod",e.toRef(r,"filterMethod")),m.value=p(),n({getCheckedCheckboxes:fe,getCheckedRadioButtons:pe,getMatching:ge,getSelected:_}),(x,k)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"treeElement",ref:C,class:e.normalizeClass(["grtv-wrapper",l.skinClass])},[G.value?e.createCommentVNode("",!0):e.renderSlot(x.$slots,"loading-root",{key:0},()=>[st]),G.value?(e.openBlock(),e.createElementBlock("ul",{key:1,class:"grtv",role:"tree","aria-multiselectable":e.unref(H)},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.value,U=>{var oe,Z;return e.openBlock(),e.createBlock(it,{key:U[(Z=(oe=U.treeNodeSpec)==null?void 0:oe.idProperty)!=null?Z:"id"],"aria-key-map":Ne.value,depth:0,"model-defaults":l.modelDefaults,"initial-model":U,"selection-mode":l.selectionMode,"tree-id":m.value,"is-mounted":h.value,"initial-radio-group-values":o.value,onTreeNodeClick:k[0]||(k[0]=(T,D)=>x.$emit(e.unref(i).Click,T,D)),onTreeNodeDblclick:k[1]||(k[1]=(T,D)=>x.$emit(e.unref(i).DoubleClick,T,D)),onTreeNodeCheckboxChange:k[2]||(k[2]=(T,D)=>x.$emit(e.unref(i).CheckboxChange,T,D)),onTreeNodeChildCheckboxChange:k[3]||(k[3]=(T,D,L)=>x.$emit(e.unref(i).ChildCheckboxChange,T,D,L)),onTreeNodeRadioChange:k[4]||(k[4]=(T,D)=>x.$emit(e.unref(i).RadioChange,T,D)),onTreeNodeExpandedChange:k[5]||(k[5]=T=>x.$emit(e.unref(i).ExpandedChange,T)),onTreeNodeChildrenLoad:k[6]||(k[6]=T=>x.$emit(e.unref(i).ChildrenLoad,T)),onTreeNodeSelectedChange:e.unref(J),onTreeNodeAdd:k[7]||(k[7]=(T,D)=>x.$emit(e.unref(i).Add,T,D)),onTreeNodeDelete:le,onTreeNodeAriaFocusableChange:e.unref(S),onTreeNodeAriaRequestFirstFocus:k[8]||(k[8]=T=>e.unref(d)(t.value,T)),onTreeNodeAriaRequestLastFocus:k[9]||(k[9]=T=>e.unref(v)(t.value)),onTreeNodeAriaRequestPreviousFocus:k[10]||(k[10]=T=>e.unref(P)(t.value,T)),onTreeNodeAriaRequestNextFocus:k[11]||(k[11]=(T,D)=>e.unref(y)(t.value,T,D)),onTreeNodeDragMove:e.unref(te),onTreeNodeDrop:e.unref(Ce)},{checkbox:e.withCtx(({model:T,customClasses:D,inputId:L,checkboxChangeHandler:B})=>[e.renderSlot(x.$slots,"checkbox",{model:T,customClasses:D,inputId:L,checkboxChangeHandler:B})]),radio:e.withCtx(({model:T,customClasses:D,inputId:L,radioGroupValues:B,radioChangeHandler:ne})=>[e.renderSlot(x.$slots,"radio",{model:T,customClasses:D,inputId:L,radioGroupValues:B,radioChangeHandler:ne})]),text:e.withCtx(({model:T,customClasses:D})=>[e.renderSlot(x.$slots,"text",{model:T,customClasses:D})]),loading:e.withCtx(({model:T,customClasses:D})=>[e.renderSlot(x.$slots,"loading",{model:T,customClasses:D})]),_:2},1032,["aria-key-map","model-defaults","initial-model","selection-mode","tree-id","is-mounted","initial-radio-group-values","onTreeNodeSelectedChange","onTreeNodeAriaFocusableChange","onTreeNodeDragMove","onTreeNodeDrop"])}),128))],8,dt)):e.createCommentVNode("",!0)],2))}};q.TreeView=ut,Object.defineProperties(q,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
